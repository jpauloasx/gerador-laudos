<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Emitir Alerta - Defesa Civil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-4xl mx-auto py-6 px-4">
    <!-- Topo -->
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold text-red-600 flex items-center gap-2">
        üö® Emitir Alerta
      </h1>
      <a href="{{ url_for('home') }}" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-3 py-1 rounded">
        üè† In√≠cio
      </a>
    </div>

    <!-- Formul√°rio de alerta -->
    <div class="bg-white rounded-xl shadow p-5 mb-6">
      <h2 class="text-lg font-semibold text-gray-800 mb-3">Novo Alerta</h2>

      {% if alerta_emitido %}
        <div class="mb-4 px-3 py-2 rounded bg-green-100 text-green-800 text-sm">
          ‚úÖ Alerta emitido com sucesso! (Backend funcionando, pronto para integrar WhatsApp depois)
        </div>
      {% endif %}

<form method="POST" class="space-y-3">
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Alerta</label>
    <select name="tipo" id="tipoAlerta" class="w-full border rounded-lg px-3 py-2 text-sm">
      <option value="Chuvas">‚õàÔ∏è Chuvas</option>
      <option value="Enxurrada">üåä Enxurrada</option>
      <option value="Alagamento">üíß Alagamento</option>
      <option value="Deslizamento">üèûÔ∏è Deslizamento</option>
      <option value="Onda de Calor">üå°Ô∏è Onda de Calor e Baixa umidade</option>
    </select>
  </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo do Alerta</label>
          <input type="text" name="titulo" class="w-full border rounded-lg px-3 py-2 text-sm"
                 placeholder="Ex: Alerta de chuvas intensas para regi√£o Sul">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Regi√£o / Bairro / Localidade</label>
          <input type="text" name="regiao" class="w-full border rounded-lg px-3 py-2 text-sm"
                 placeholder="Ex: Regi√£o Sul de Cuiab√°, bairros X e Y">
        </div>

  <!-- Campos para onda de calor -->
<div id="camposCalor" class="hidden">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
    
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Temperatura M√°xima (¬∞C)</label>
      <input type="number" step="0.1" name="temperatura" class="w-full border rounded-lg px-3 py-2 text-sm"
             placeholder="Ex: 41.5">
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Umidade do Ar (%)</label>
      <input type="number" step="1" name="umidade" class="w-full border rounded-lg px-3 py-2 text-sm"
             placeholder="Ex: 18">
    </div>

  </div>
</div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Previs√£o de chuva (mm)</label>
            <input type="number" name="chuva_mm" class="w-full border rounded-lg px-3 py-2 text-sm"
                   placeholder="Ex: 80">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Validade do alerta</label>
            <input type="datetime-local" name="validade" class="w-full border rounded-lg px-3 py-2 text-sm">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Mensagem do alerta</label>
          <textarea name="mensagem" rows="4"
                    class="w-full border rounded-lg px-3 py-2 text-sm"
                    placeholder="Ex: Defesa Civil de Cuiab√° informa: ALERTA DE CHUVA INTENSA para a regi√£o..."></textarea>
        </div>

        <div class="flex justify-end gap-2 pt-2">
          <button type="reset" class="px-4 py-2 rounded-lg border text-sm text-gray-700 hover:bg-gray-100">
            Limpar
          </button>
          <button type="submit" class="px-4 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700">
            üö® Emitir Alerta
          </button>
        </div>
      </form>
    </div>

    <!-- √öltimos alertas emitidos -->
    <div class="bg-white rounded-xl shadow p-5">
      <h2 class="text-lg font-semibold text-gray-800 mb-3">Hist√≥rico (sess√£o atual)</h2>

      {% if alertas and alertas|length > 0 %}
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="bg-gray-50 text-gray-700">
                <th class="px-3 py-2 text-left">Data</th>
                <th class="px-3 py-2 text-left">Tipo</th>
                <th class="px-3 py-2 text-left">T√≠tulo</th>
                <th class="px-3 py-2 text-left">Regi√£o</th>
                <th class="px-3 py-2 text-left">Chuva (mm)</th>
                <th class="px-3 py-2 text-left">Validade</th>
              </tr>
            </thead>
            <tbody>
              {% for a in alertas|reverse %}
              <tr class="border-t">
                <td class="px-3 py-2">{{ a.data_emissao }}</td>
                <td class="px-3 py-2">{{ a.tipo }}</td>
                <td class="px-3 py-2">{{ a.titulo }}</td>
                <td class="px-3 py-2">{{ a.regiao }}</td>
                <td class="px-3 py-2">{{ a.chuva_mm or "-" }}</td>
                <td class="px-3 py-2">{{ a.validade or "-" }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-sm text-gray-500">Nenhum alerta emitido nesta sess√£o ainda.</p>
      {% endif %}
    </div>
  </div>

<script>
  const selectTipo = document.getElementById("tipoAlerta");
  const camposCalor = document.getElementById("camposCalor");

  function atualizarCampos() {
    if (selectTipo.value === "Onda de Calor") {
      camposCalor.classList.remove("hidden");
    } else {
      camposCalor.classList.add("hidden");
    }
  }

  // Atualiza ao mudar o tipo
  selectTipo.addEventListener("change", atualizarCampos);

  // Atualiza uma vez ao carregar (√∫til ao recarregar ap√≥s POST)
  atualizarCampos();
</script>
  
</body>
</html>
