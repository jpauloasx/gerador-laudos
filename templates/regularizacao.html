<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Gerador de Relat√≥rio - Regulariza√ß√£o Fundi√°ria</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      max-width: 700px;
    }
    select.form-select option {
      white-space: normal !important;
      line-height: 1.4em;
    }
  </style>
</head>

<body>
  <div class="container py-4 px-3 px-md-5">

    <!-- VOLTAR -->
    <div class="d-flex justify-content-end mb-3">
      <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-sm">‚¨ÖÔ∏è Voltar</a>
    </div>

    <!-- LOGOS -->
    <div class="row justify-content-center align-items-center mb-4">
      <div class="col-auto">
        <img src="{{ url_for('static', filename='defesa_civil.jpeg') }}" class="img-fluid" style="max-height: 80px;">
      </div>
      <div class="col-auto">
        <img src="{{ url_for('static', filename='pref_cba.jpeg') }}" class="img-fluid" style="max-height: 80px;">
      </div>
    </div>

    <!-- T√çTULO -->
    <h3 class="mb-4 text-center text-primary fw-bold">Gerador de Relat√≥rio T√©cnico - Regulariza√ß√£o Fundi√°ria</h3>

    <!-- FORMUL√ÅRIO -->
    <form method="POST" enctype="multipart/form-data">

      {% for label, name in campos %}
      <div class="mb-3">
        <label class="form-label fw-semibold">{{ label }}</label>

        {% if name == "latitude" %}
        <div class="input-group mb-2">
          <button type="button" class="btn btn-sm btn-outline-primary" onclick="atualizarLocalizacao()">üìç Atualizar</button>
          <input type="text" name="latitude" id="latitude" class="form-control" placeholder="Ex: -15.601234" required>
        </div>
        <a id="link_mapa" class="btn btn-sm btn-outline-secondary" target="_blank" style="display:none;">
          üåç Ver no Mapa
        </a>

        {% elif name == "longitude" %}
        <input type="text" name="longitude" id="longitude" class="form-control" placeholder="Ex: -56.097900" required>

        {% elif name in ["cpf", "telefone", "data_vistoria", "data_relatorio"] %}
        <input type="text" name="{{ name }}" id="{{ name }}" class="form-control" required>

        {% else %}
        <input type="text" name="{{ name }}" class="form-control" required>
        {% endif %}
      </div>
      {% endfor %}

      <!-- Presen√ßa de cursos d'√°gua -->
      <div class="mb-4">
        <h5 class="fw-semibold">Presen√ßa de cursos d'√°gua</h5>
        <select class="form-select" name="presenca_cursos" multiple style="height:auto; max-height:150px;">
          <option>
            Foi identificado o curso d‚Äô√°gua que atravessa parte da quadra, incidindo diretamente sobre √°reas de preserva√ß√£o permanente (APP). 
            Observa-se que algumas edifica√ß√µes encontram-se implantadas em proximidade imediata √†s margens do c√≥rrego. 
            Ressalta-se que o risco n√£o se estende a toda a quadra, mas se concentra especificamente nas edifica√ß√µes localizadas junto ao leito do c√≥rrego.
          </option>
          <option>
            N√£o foram identificados cursos d‚Äô√°gua na quadra em an√°lise, de modo que n√£o se constatam, no momento, 
            riscos associados √† presen√ßa de corpos h√≠dricos ou √°reas de preserva√ß√£o permanente (APP) dentro de seus limites.
          </option>
        </select>
        <input type="text" name="presenca_cursos_outro" class="form-control mt-2" placeholder="Outro...">
      </div>

      <!-- Sinais de instabilidade -->
      <div class="mb-4">
        <h5 class="fw-semibold">Sinais de Instabilidade</h5>
        <select class="form-select" name="sinais_instabilidade" multiple>
          <option>Trincas e Rachaduras</option>
          <option>Eros√£o</option>
          <option>Inclina√ß√£o</option>
          <option>Deslizamento</option>
          <option>Infiltra√ß√£o</option>
        </select>
      </div>

      <!-- Potenciais fatores de risco -->
      <div class="mb-4">
        <h5 class="fw-semibold">Potenciais Fatores de Risco</h5>
        <select class="form-select" name="fatores_risco" multiple>
          <option>Ac√∫mulo de √°gua</option>
          <option>Aus√™ncia e/ou defici√™ncia de drenagem</option>
          <option>Desn√≠veis acentuados no terreno</option>
          <option>Macro-fissuras em muros, indicando movimenta√ß√£o do solo</option>
          <option>Ocupa√ß√µes em √°reas suscet√≠veis a alagamento e/ou escorregamento</option>
        </select>
      </div>

      <!-- Grau de Risco -->
      <div class="mb-3">
        <label class="form-label fw-semibold">Grau de Risco</label>
        <select name="grau_risco" class="form-select">
          <option>MUITO BAIXO</option>
          <option>BAIXO</option>
          <option selected>M√âDIO</option>
          <option>ALTO</option>
          <option>MUITO ALTO</option>
        </select>
      </div>

      <!-- Imagens -->
      <h5 class="mt-5 mb-3 fw-semibold">Imagens e Descri√ß√µes</h5>
      {% for i in range(1, 8) %}
      <div class="mb-3">
        <label class="form-label">Imagem {{ i }}</label>
        <input type="file" name="imagem{{ i }}" class="form-control">
        <input type="text" name="descricao{{ i }}" class="form-control mt-2" placeholder="Descri√ß√£o da imagem {{ i }}">
      </div>
      {% endfor %}

      <!-- Bot√µes -->
      <div class="d-grid gap-2 mt-4">
        <button type="submit" class="btn btn-primary">‚úÖ Gerar Laudo</button>
        <button type="button" class="btn btn-outline-danger" onclick="confirmarLimpeza()">üóëÔ∏è Limpar Tudo</button>
      </div>
    </form>
  </div>

  <!-- Geolocaliza√ß√£o -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script>
    function atualizarLocalizacao() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (pos) {
            const lat = pos.coords.latitude.toFixed(6);
            const lon = pos.coords.longitude.toFixed(6);
            document.getElementById("latitude").value = lat;
            document.getElementById("longitude").value = lon;

            const linkMapa = document.getElementById("link_mapa");
            linkMapa.href = `https://www.google.com/maps?q=${lat},${lon}`;
            linkMapa.style.display = "inline-block";
          },
          err => alert("Erro ao obter localiza√ß√£o: " + err.message),
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      } else {
        alert("Geolocaliza√ß√£o n√£o suportada pelo navegador.");
      }
    }

    function confirmarLimpeza() {
      if (confirm("Tem certeza que deseja limpar todos os campos?")) {
        document.querySelector("form").reset();
      }
    }
  </script>
</body>
</html>
